export class CuppaStorage{static setData(name,opts){cuppa.setData(name,opts)}static getData(name,opts){return cuppa.getData(name,opts)}static deleteData=function(name,opts){cuppa.deleteData(name,opts)};static removeCallback(name,callback){cuppa.removeListener(name,callback)}static removeListener(name,callback){CuppaStorage.removeCallback(name,callback)}}export class GetStorage extends HTMLElement{name;store;default;data;constructor(){super(),this.onUpdateStorage=this.onUpdateStorage.bind(this)}connectedCallback(){setTimeout(()=>{this.name=this.getAttribute("name"),this.store=this.getAttribute("store"),this.default=this.getAttribute("default"),CuppaStorage.getData(this.name,{callback:this.onUpdateStorage,default:this.default,store:this.store})},0)}onUpdateStorage(data){this.data=data,this.dispatchEvent(new CustomEvent("update",{detail:this.data}))}disconnectedCallback(){CuppaStorage.removeCallback(this.name,this.onUpdateStorage)}}customElements.define("get-storage",GetStorage);const cuppa=document.defaultView.cuppa||{};cuppa.dataDefault=cuppa.dataDefault||{},cuppa.data=cuppa.data||{},cuppa.setData=function(name,opts){if(null!=(opts={storage:"",silence:!1,data:null,...opts}).store&&(opts.storage=opts.store),void 0!==opts.default&&null!==opts.default){cuppa.dataDefault[name]=opts.default,opts.default=null;let current=cuppa.getData(name,opts);return null!=current&&null!=current||(current=cuppa.dataDefault[name]),opts.data=current,void cuppa.setData(name,opts).then()}cuppa.data[name]=opts.data,"local"===opts.storage?localStorage.setItem(name,JSON.stringify(opts.data)):"session"===opts.storage&&sessionStorage.setItem(name,JSON.stringify(opts.data)),opts.silence||cuppa.executeListener(name,opts.data)},cuppa.getData=function(name,opts){null!=(opts={storage:"",callback:null,default:null,...opts}).store&&(opts.storage=opts.store);let data=cuppa.data[name];if("local"===opts.storage){let ls=localStorage.getItem(name);ls&&(data=JSON.parse(ls))}else if("session"===opts.storage){let st=sessionStorage.getItem(name);st&&(data=JSON.parse(st))}return void 0===data&&(data=opts.default),null!=data&&opts.callback&&opts.callback(data),opts.callback&&cuppa.addListener(name,opts.callback),data},cuppa.getDataSync=function(name,opts){opts=cuppa.mergeObjects([{default:null},opts]);let data=cuppa.data[name];return void 0===data&&(data=opts.default),data},cuppa.deleteData=function(name,opts){null!=(opts=cuppa.mergeObjects([{storage:""},opts])).store&&(opts.storage=opts.store),cuppa.data[name]=null,"local"===opts.storage?localStorage.removeItem(name):"session"===opts.storage&&sessionStorage.removeItem(name)},cuppa.listeners=cuppa.listeners||{},cuppa.addListener=function(name,callback){cuppa.listeners[name]||(cuppa.listeners[name]=[]),cuppa.listeners[name].push(callback)},cuppa.removeListener=function(name,callback,toString){cuppa.listeners[name]||(cuppa.listeners[name]=[]);let array=cuppa.listeners[name];for(let i=0;i<array.length;i++)toString?array[i].toString()===callback.toString()&&array.splice(i,1):array[i]===callback&&array.splice(i,1)},cuppa.removeListenerGroup=function(name){delete cuppa.listeners[name]},cuppa.executeListener=function(name,data){cuppa.listeners[name]||(cuppa.listeners[name]=[]);let array=cuppa.listeners[name];for(let i=0;i<array.length;i++)array[i](data)};